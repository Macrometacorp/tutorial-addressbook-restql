{"version":3,"file":"stream.js","sourceRoot":"","sources":["../../src/stream.ts"],"names":[],"mappings":";;AACA,0CAAkD;AAClD,sCAAmC;AAEnC,aAAa;AACb,SAAS;AACT,eAAe;AAEf,gDAAsC;AAEtC,IAAY,eAA6C;AAAzD,WAAY,eAAe;IAAG,4CAAyB,CAAA;AAAC,CAAC,EAA7C,eAAe,GAAf,uBAAe,KAAf,uBAAe,QAA8B;AAAA,CAAC;AAS1D;IASI,YAAY,UAAsB,EAAE,IAAY,EAAE,QAAiB,KAAK;QACpE,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;QAC9B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACrB,IAAI,CAAC,aAAa,GAAG,SAAS,CAAC;IACnC,CAAC;IAED,QAAQ,CAAC,SAAkB;QACvB,OAAO,0BAAiB,CAAC,IAAI,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;IACnD,CAAC;IAED,YAAY;QACR,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAE;YACrB,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,gCAAgC,CAAC,mBAA2B;QACxD,MAAM,SAAS,GAAG,oCAAoC,mBAAmB,EAAE,CAAC;QAC5E,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,OAAO;QACH,MAAM,SAAS,GAAG,UAAU,CAAC;QAC7B,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,UAAU;QACN,MAAM,SAAS,GAAG,aAAa,CAAC;QAChC,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,iBAAiB;QACb,MAAM,SAAS,GAAG,aAAa,CAAC;QAChC,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,mBAAmB;QACf,MAAM,SAAS,GAAG,QAAQ,CAAC;QAC3B,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,kBAAkB,CAAC,YAAoB;QACnC,MAAM,SAAS,GAAG,iBAAiB,YAAY,EAAE,CAAC;QAClD,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,QAAQ;YAChB,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,2BAA2B,CAAC,YAAoB;QAC5C,MAAM,SAAS,GAAG,iBAAiB,YAAY,EAAE,CAAC;QAClD,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,cAAc,CAAC,YAAoB,EAAE,mBAA2B;QAC5D,MAAM,SAAS,GAAG,iBAAiB,YAAY,mBAAmB,mBAAmB,EAAE,CAAC;QACxF,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,WAAW,CAAC,YAAoB;QAC5B,MAAM,SAAS,GAAG,iBAAiB,YAAY,cAAc,CAAC;QAC9D,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,4BAA4B,CAAC,YAAoB,EAAE,SAAiB;QAChE,MAAM,SAAS,GAAG,iBAAiB,YAAY,gBAAgB,SAAS,EAAE,CAAC;QAC3E,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,oBAAoB,CAAC,YAAoB,EAAE,WAAmB;QAC1D,MAAM,SAAS,GAAG,iBAAiB,YAAY,SAAS,WAAW,EAAE,CAAC;QACtE,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,eAAe,CAAC,YAAoB;QAChC,MAAM,SAAS,GAAG,iBAAiB,YAAY,WAAW,CAAC;QAC3D,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,mBAAmB;QACf,MAAM,SAAS,GAAG,gBAAgB,CAAC;QACnC,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,eAAe;QACX,MAAM,SAAS,GAAG,YAAY,CAAC;QAC/B,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAC3B;YACI,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;YAC9B,EAAE,EAAE,SAAS,IAAI,CAAC,KAAK,EAAE;SAC5B,EACD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAClB,CAAC;IACN,CAAC;IAED,QAAQ,CAAC,gBAAwB,EAAE,WAA0B,EAAE,KAAa;QACxE,MAAM,YAAY,GAAG,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAC/C,IAAI,YAAY,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,YAAY,CAAC,QAAQ,CAAC,OAAO,CAAC;YAAE,MAAM,iBAAiB,CAAC;QAC7F,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,WAAW,CAAC;QAC5D,MAAM,OAAO,GAAG,eAAe,CAAC,UAAU,CAAC;QAC3C,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC;QACnD,MAAM,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC;QAChD,IAAI,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC;QAC9C,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM;YAAE,MAAM,iDAAiD,CAAA;QAE/E,MAAM,WAAW,GAAG,SAAS,KAAK,uBAAuB,OAAO,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,IAAI,IAAI,CAAC,IAAI,IAAI,gBAAgB,EAAE,CAAC;QAElI,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,cAAE,CAAC,WAAW,CAAC,CAAC,CAAC;QACtC,MAAM,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC;QAE7C,MAAM,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QAE5C,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE;YACrB,OAAO,MAAM,KAAK,UAAU,IAAI,MAAM,EAAE,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE;YACtB,IAAI,CAAC,aAAa,IAAI,aAAa,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YACxD,OAAO,OAAO,KAAK,UAAU,IAAI,OAAO,EAAE,CAAC;QAE/C,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,CAAQ,EAAE,EAAE;YAC9B,OAAO,CAAC,GAAG,CAAC,8BAA8B,EAAE,CAAC,CAAC,CAAC;YAC/C,OAAO,OAAO,KAAK,UAAU,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,GAAW,EAAE,EAAE;YACnC,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAChC,MAAM,MAAM,GAAG,EAAE,WAAW,EAAE,OAAO,CAAC,SAAS,EAAE,CAAC;YAClD,MAAM,EAAE,OAAO,EAAE,GAAG,OAAO,CAAC;YAE5B,IAAI,OAAO,KAAK,WAAI,CAAC,MAAM,CAAC,IAAI,OAAO,KAAK,MAAM,EAAE;gBAChD,IAAI,OAAO,SAAS,KAAK,UAAU,EAAE;oBACjC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC;oBACtC,SAAS,CAAC,GAAG,CAAC,CAAC;iBAClB;aACJ;iBAAM;gBACH,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC;aACzC;QACL,CAAC,CAAC,CAAC;QAEH,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;IAEpD,CAAC;IAEO,YAAY,CAAC,KAAa;QAC9B,MAAM,YAAY,GAAG,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAC/C,IAAI,YAAY,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,YAAY,CAAC,QAAQ,CAAC,OAAO,CAAC;YAAE,MAAM,iBAAiB,CAAC;QAC7F,MAAM,OAAO,GAAG,eAAe,CAAC,UAAU,CAAC;QAC3C,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC;QACnD,MAAM,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC;QAChD,IAAI,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC;QAC9C,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM;YAAE,MAAM,iDAAiD,CAAA;QAE/E,MAAM,eAAe,GAAG,SAAS,KAAK,uBAAuB,OAAO,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;QAElH,IAAI,CAAC,aAAa,GAAG,cAAE,CAAC,eAAe,CAAC,CAAC;QAEzC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE;YAC/B,IAAI,CAAC,aAAa,GAAG,WAAW,CAAC,GAAG,EAAE;gBAClC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;YACjE,CAAC,EAAE,KAAK,CAAC,CAAC;QACd,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,CAAQ,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,wBAAwB,EAAE,CAAC,CAAC,CAAC,CAAC;IAC3F,CAAC;IAED,QAAQ,CAAC,OAAe,EAAE,KAAc;QAEpC,IAAI,IAAI,CAAC,SAAS,KAAK,SAAS,EAAE;YAC9B,IAAI,CAAC,KAAK;gBAAE,MAAM,uDAAuD,CAAC;YAE1E,MAAM,YAAY,GAAG,KAAK,CAAC,iBAAiB,EAAE,CAAC;YAC/C,IAAI,YAAY,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,YAAY,CAAC,QAAQ,CAAC,OAAO,CAAC;gBAAE,MAAM,iBAAiB,CAAC;YAC7F,MAAM,OAAO,GAAG,eAAe,CAAC,UAAU,CAAC;YAC3C,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC;YACnD,MAAM,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC;YAChD,IAAI,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAC;YAC9C,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM;gBAAE,MAAM,iDAAiD,CAAA;YAE/E,MAAM,WAAW,GAAG,SAAS,KAAK,uBAAuB,OAAO,IAAI,MAAM,IAAI,MAAM,IAAI,MAAM,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;YAE9G,IAAI,CAAC,SAAS,GAAG,cAAE,CAAC,WAAW,CAAC,CAAC;YAEjC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,GAAW,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,GAAG,CAAC,CAAC,CAAC;YAEpF,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE;gBAC3B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,WAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;YACpE,CAAC,CAAC,CAAC;YACH,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,CAAM,EAAE,EAAE;gBAClC,OAAO,CAAC,GAAG,CAAC,6BAA6B,EAAE,CAAC,CAAC,CAAC;YAClD,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,CAAQ,EAAE,EAAE;gBACpC,OAAO,CAAC,GAAG,CAAC,8BAA8B,EAAE,CAAC,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC;SAEN;aAAM;YACH,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,KAAK,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE;gBACnD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,WAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;aACnE;iBAAM;gBACH,OAAO,CAAC,IAAI,CAAC,gDAAgD,CAAC,CAAC;aAClE;SACJ;IAEL,CAAC;IAED,gBAAgB;QACZ,IAAI,CAAC,aAAa,IAAI,aAAa,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACxD,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;QAC7C,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,CAAC,SAAS,EAAE,CAAC;QACrD,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,CAAC;IACjF,CAAC;CACJ;AA/TD,wBA+TC","sourcesContent":["import { Connection } from './connection';\nimport { getFullStreamPath } from './util/helper';\nimport { btoa } from './util/btoa';\n\n// 2 document\n// 3 edge\n// 4 persistent\n\nimport { ws } from './util/webSocket';\n\nexport enum StreamConstants { PERSISTENT = \"persistent\" };\n\nexport type wsCallbackObj = {\n    onopen?: () => void,\n    onclose?: () => void,\n    onerror?: (e: Error) => void,\n    onmessage: (msg: string) => void\n}\n\nexport class Stream {\n    private _connection: Connection;\n    name: string;\n    local: boolean;\n    private _producer: any;\n    private _noopProducer: any;\n    private _consumers: any[];\n    private setIntervalId?: any;\n\n    constructor(connection: Connection, name: string, local: boolean = false) {\n        this._connection = connection;\n        this.name = name;\n        this.local = local;\n        this._consumers = [];\n        this.setIntervalId = undefined;\n    }\n\n    _getPath(urlSuffix?: string): string {\n        return getFullStreamPath(this.name, urlSuffix);\n    }\n\n    createStream() {\n        return this._connection.request(\n            {\n                method: \"POST\",\n                path: this._getPath(),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    expireMessagesOnAllSubscriptions(expireTimeInSeconds: number) {\n        const urlSuffix = `/all_subscription/expireMessages/${expireTimeInSeconds}`;\n        return this._connection.request(\n            {\n                method: \"POST\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    backlog() {\n        const urlSuffix = \"/backlog\";\n        return this._connection.request(\n            {\n                method: \"GET\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    compaction() {\n        const urlSuffix = \"/compaction\";\n        return this._connection.request(\n            {\n                method: \"GET\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    triggerCompaction() {\n        const urlSuffix = \"/compaction\";\n        return this._connection.request(\n            {\n                method: \"PUT\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    getStreamStatistics() {\n        const urlSuffix = \"/stats\";\n        return this._connection.request(\n            {\n                method: \"GET\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    deleteSubscription(subscription: string) {\n        const urlSuffix = `/subscription/${subscription}`;\n        return this._connection.request(\n            {\n                method: \"DELETE\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    resetSubscriptionToPosition(subscription: string) {\n        const urlSuffix = `/subscription/${subscription}`;\n        return this._connection.request(\n            {\n                method: \"PUT\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    expireMessages(subscription: string, expireTimeInSeconds: number) {\n        const urlSuffix = `/subscription/${subscription}/expireMessages/${expireTimeInSeconds}`;\n        return this._connection.request(\n            {\n                method: \"POST\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    resetCursor(subscription: string) {\n        const urlSuffix = `/subscription/${subscription}/resetcursor`;\n        return this._connection.request(\n            {\n                method: \"POST\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    resetSubscriptionToTimestamp(subscription: string, timestamp: number) {\n        const urlSuffix = `/subscription/${subscription}/resetcursor/${timestamp}`;\n        return this._connection.request(\n            {\n                method: \"POST\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    skipNumberOfMessages(subscription: string, numMessages: number) {\n        const urlSuffix = `/subscription/${subscription}/skip/${numMessages}`;\n        return this._connection.request(\n            {\n                method: \"POST\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    skipAllMessages(subscription: string) {\n        const urlSuffix = `/subscription/${subscription}/skip_all`;\n        return this._connection.request(\n            {\n                method: \"POST\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    getSubscriptionList() {\n        const urlSuffix = \"/subscriptions\";\n        return this._connection.request(\n            {\n                method: \"GET\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    terminateStream() {\n        const urlSuffix = \"/terminate\";\n        return this._connection.request(\n            {\n                method: \"POST\",\n                path: this._getPath(urlSuffix),\n                qs: `local=${this.local}`\n            },\n            res => res.body\n        );\n    }\n\n    consumer(subscriptionName: string, callbackObj: wsCallbackObj, dcUrl: string) {\n        const lowerCaseUrl = dcUrl.toLocaleLowerCase();\n        if (lowerCaseUrl.includes(\"http\") || lowerCaseUrl.includes(\"https\")) throw \"Invalid DC name\";\n        const { onopen, onclose, onerror, onmessage } = callbackObj;\n        const persist = StreamConstants.PERSISTENT;\n        const region = this.local ? 'c8local' : 'c8global';\n        const tenant = this._connection.getTenantName();\n        let dbName = this._connection.getFabricName();\n        if (!dbName || !tenant) throw \"Set correct DB and/or tenant name before using.\"\n\n        const consumerUrl = `wss://${dcUrl}/_ws/ws/v2/consumer/${persist}/${tenant}/${region}.${dbName}/${this.name}/${subscriptionName}`;\n\n        this._consumers.push(ws(consumerUrl));\n        const lastIndex = this._consumers.length - 1;\n\n        const consumer = this._consumers[lastIndex];\n\n        consumer.on('open', () => {\n            typeof onopen === 'function' && onopen();\n        });\n\n        consumer.on('close', () => {\n            this.setIntervalId && clearInterval(this.setIntervalId);\n            typeof onclose === 'function' && onclose();\n\n        });\n\n        consumer.on('error', (e: Error) => {\n            console.log(\"Consumer connection errored \", e);\n            typeof onerror === 'function' && onerror(e);\n        });\n\n        consumer.on(\"message\", (msg: string) => {\n            const message = JSON.parse(msg);\n            const ackMsg = { \"messageId\": message.messageId };\n            const { payload } = message;\n\n            if (payload !== btoa('noop') && payload !== 'noop') {\n                if (typeof onmessage === 'function') {\n                    consumer.send(JSON.stringify(ackMsg));\n                    onmessage(msg);\n                }\n            } else {\n                consumer.send(JSON.stringify(ackMsg));\n            }\n        });\n\n        !this._noopProducer && this.noopProducer(dcUrl);\n\n    }\n\n    private noopProducer(dcUrl: string) {\n        const lowerCaseUrl = dcUrl.toLocaleLowerCase();\n        if (lowerCaseUrl.includes(\"http\") || lowerCaseUrl.includes(\"https\")) throw \"Invalid DC name\";\n        const persist = StreamConstants.PERSISTENT;\n        const region = this.local ? 'c8local' : 'c8global';\n        const tenant = this._connection.getTenantName();\n        let dbName = this._connection.getFabricName();\n        if (!dbName || !tenant) throw \"Set correct DB and/or tenant name before using.\"\n\n        const noopProducerUrl = `wss://${dcUrl}/_ws/ws/v2/producer/${persist}/${tenant}/${region}.${dbName}/${this.name}`;\n\n        this._noopProducer = ws(noopProducerUrl);\n\n        this._noopProducer.on('open', () => {\n            this.setIntervalId = setInterval(() => {\n                this._noopProducer.send(JSON.stringify({ payload: 'noop' }));\n            }, 30000);\n        });\n\n        this._noopProducer.on('error', (e: Event) => console.log(\"noop producer errored \", e));\n    }\n\n    producer(message: string, dcUrl?: string) {\n\n        if (this._producer === undefined) {\n            if (!dcUrl) throw \"DC name not provided to establish producer connection\";\n\n            const lowerCaseUrl = dcUrl.toLocaleLowerCase();\n            if (lowerCaseUrl.includes(\"http\") || lowerCaseUrl.includes(\"https\")) throw \"Invalid DC name\";\n            const persist = StreamConstants.PERSISTENT;\n            const region = this.local ? 'c8local' : 'c8global';\n            const tenant = this._connection.getTenantName();\n            let dbName = this._connection.getFabricName();\n            if (!dbName || !tenant) throw \"Set correct DB and/or tenant name before using.\"\n\n            const producerUrl = `wss://${dcUrl}/_ws/ws/v2/producer/${persist}/${tenant}/${region}.${dbName}/${this.name}`;\n\n            this._producer = ws(producerUrl);\n\n            this._producer.on(\"message\", (msg: string) => console.log('received ack: %s', msg));\n\n            this._producer.on(\"open\", () => {\n                this._producer.send(JSON.stringify({ payload: btoa(message) }));\n            });\n            this._producer.on('close', (e: any) => {\n                console.log(\"Producer connection closed \", e);\n            });\n\n            this._producer.on('error', (e: Error) => {\n                console.log(\"Producer connection errored \", e);\n            });\n\n        } else {\n            if (this._producer.readyState === this._producer.OPEN) {\n                this._producer.send(JSON.stringify({ payload: btoa(message) }));\n            } else {\n                console.warn(\"Producer connection not open yet. Please wait.\");\n            }\n        }\n\n    }\n\n    closeConnections() {\n        this.setIntervalId && clearInterval(this.setIntervalId);\n        this._producer && this._producer.terminate();\n        this._noopProducer && this._noopProducer.terminate();\n        this._consumers && this._consumers.forEach(consumer => consumer.terminate());\n    }\n}"]}