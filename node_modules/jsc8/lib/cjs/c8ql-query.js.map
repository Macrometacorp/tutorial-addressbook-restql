{"version":3,"file":"c8ql-query.js","sourceRoot":"","sources":["../../src/c8ql-query.ts"],"names":[],"mappings":";;AAAA,6CAA4D;AAmB5D,qBAA4B,KAAU;IACpC,OAAO,OAAO,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC;AACzD,CAAC;AAFD,kCAEC;AAED,uBAA8B,OAAY;IACxC,OAAO,OAAO,CAAC,OAAO,IAAI,OAAO,OAAO,CAAC,MAAM,KAAK,UAAU,CAAC,CAAC;AAClE,CAAC;AAFD,sCAEC;AAED,cACE,OAA6B,EAC7B,GAAG,IAAiB;IAEpB,MAAM,QAAQ,GAA0B,EAAE,CAAC;IAC3C,MAAM,QAAQ,GAAG,EAAE,CAAC;IACpB,IAAI,KAAK,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;IACvB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACpC,MAAM,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACzB,IAAI,KAAK,GAAG,QAAQ,CAAC;QACrB,IAAI,aAAa,CAAC,QAAQ,CAAC,EAAE;YAC3B,KAAK,IAAI,GAAG,QAAQ,CAAC,MAAM,EAAE,GAAG,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;YACjD,SAAS;SACV;QACD,MAAM,KAAK,GAAG,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QACzC,MAAM,OAAO,GAAG,KAAK,KAAK,CAAC,CAAC,CAAC;QAC7B,IAAI,IAAI,GAAG,QAAQ,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;QACvD,IAAI,2BAAc,CAAC,QAAQ,CAAC,EAAE;YAC5B,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;YAClB,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC;SACvB;QACD,IAAI,CAAC,OAAO,EAAE;YACZ,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACxB,QAAQ,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC;SACxB;QACD,KAAK,IAAI,IAAI,IAAI,GAAG,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;KACtC;IACD,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC;AAC7B,CAAC;AA5BD,oBA4BC;AAED,WAAiB,IAAI;IACN,YAAO,GAAG,CAAC,KAAU,EAAe,EAAE,CAAC,CAAC;QACnD,MAAM;YACJ,OAAO,MAAM,CAAC,KAAK,CAAC,CAAC;QACvB,CAAC;KACF,CAAC,CAAC;AACL,CAAC,EANgB,IAAI,GAAJ,YAAI,KAAJ,YAAI,QAMpB","sourcesContent":["import { C8Collection, isC8Collection } from \"./collection\";\n\nexport interface C8QLQuery {\n  query: string;\n  bindVars: { [key: string]: any };\n  options?: any\n}\n\nexport interface C8QLLiteral {\n  toC8QL: () => string;\n}\n\nexport type C8QLValue =\n  | string\n  | number\n  | boolean\n  | C8Collection\n  | C8QLLiteral;\n\nexport function isC8QLQuery(query: any): query is C8QLQuery {\n  return Boolean(query && query.query && query.bindVars);\n}\n\nexport function isC8QLLiteral(literal: any): literal is C8QLLiteral {\n  return Boolean(literal && typeof literal.toC8QL === \"function\");\n}\n\nexport function c8ql(\n  strings: TemplateStringsArray,\n  ...args: C8QLValue[]\n): C8QLQuery {\n  const bindVars: C8QLQuery[\"bindVars\"] = {};\n  const bindVals = [];\n  let query = strings[0];\n  for (let i = 0; i < args.length; i++) {\n    const rawValue = args[i];\n    let value = rawValue;\n    if (isC8QLLiteral(rawValue)) {\n      query += `${rawValue.toC8QL()}${strings[i + 1]}`;\n      continue;\n    }\n    const index = bindVals.indexOf(rawValue);\n    const isKnown = index !== -1;\n    let name = `value${isKnown ? index : bindVals.length}`;\n    if (isC8Collection(rawValue)) {\n      name = `@${name}`;\n      value = rawValue.name;\n    }\n    if (!isKnown) {\n      bindVals.push(rawValue);\n      bindVars[name] = value;\n    }\n    query += `@${name}${strings[i + 1]}`;\n  }\n  return { query, bindVars };\n}\n\nexport namespace c8ql {\n  export const literal = (value: any): C8QLLiteral => ({\n    toC8QL() {\n      return String(value);\n    }\n  });\n}\n"]}