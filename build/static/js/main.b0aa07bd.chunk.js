(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,a){e.exports=a.p+"static/media/c8db-edition-edited.393eb901.svg"},104:function(e,t,a){e.exports=a.p+"static/media/circle_spinner.25ef2804.gif"},117:function(e,t,a){e.exports=a(301)},122:function(e,t,a){},124:function(e,t,a){},301:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a.n(n),o=a(16),r=a.n(o),i=(a(122),a(36)),l=a(35),c=a(100),d=a(101),u=a(115),m=a(102),h=a(116),f=a(14),E=a(27),p=a.n(E),b=a(103),v=a.n(b),g=a(104),k=a.n(g),y=a(21),S=a.n(y),O=a(50),N=a.n(O),j=a(110),w=a.n(j),x=a(112),C=a.n(x),M=a(17),D=a.n(M),A=a(111),F=a.n(A),T=a(71),R=a.n(T),U=a(34),P=a.n(U),H=a(113),_=a.n(H),I=a(114),W=a.n(I),z=a(68),J=a.n(z),L=a(70),q=a.n(L),B=a(67),K=a.n(B),V=a(106),Y=a.n(V),$=a(69),G=a.n($),Q=a(109),X=a.n(Q),Z=a(107),ee=a.n(Z),te=a(108),ae=a.n(te),ne={global:"demo2.eng1.macrometa.io",us:"demo2-asia-east1.eng1.macrometa.io",dublin:"demo2-us-central1.eng1.macrometa.io",europe:"demo2-europe-west2.eng1.macrometa.io"},se=a(37),oe=function(e){var t=JSON.parse(e.result);return Array.isArray(t)?t:[]},re=function(e,t){return t.reduce(function(t,a){return e===a.key?t:[].concat(Object(se.a)(t),[a])},[])},ie=function(e,t){var a=e._key,n=e.firstname,s=e.lastname,o=e.email,r=!1,i=t.reduce(function(e,t){return r=r||a===t.key,a===t.key?[].concat(Object(se.a)(e),[{key:a,firstname:n,lastname:s,email:o}]):[].concat(Object(se.a)(e),[t])},[]);return i=r?i:[].concat(Object(se.a)(i),[{key:a,firstname:n,lastname:s,email:o}])},le=function(e){return"wss://".concat(e,"/_ws/ws/v2/consumer/persistent/demo/c8local.addressbook/addresses/").concat(Math.floor(Math.random()*Math.floor(99999)))},ce=function(e){return"wss://".concat(e,"/_ws/ws/v2/producer/persistent/demo/c8local.addressbook/addresses")},de=function(e){return Object.keys(e).reduce(function(t,a){var n={label:a.toUpperCase(),value:e[a]};return t.push(n),t},[])},ue=(a(124),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).handleFormChange=function(e){return function(t){a.setState(Object(l.a)({},e,t.target.value))}},a.state={shouldShowModal:!1,showSnackbar:!1,isEdit:!1,snackbarText:"",firstName:"",lastName:"",emailAddress:"",firstNameHasError:!1,lastNameHasError:!1,emailAddressHasError:!1,data:[],isLoading:!0,lastEditElem:null,selectedRegionUrl:"",selectedRegionName:"",regionModal:!0,availableRegions:de(ne),baseUrl:"",wsUrl:"",producerUrl:""},a.onFabPress=a.onFabPress.bind(Object(f.a)(Object(f.a)(a))),a.handleFormChange=a.handleFormChange.bind(Object(f.a)(Object(f.a)(a))),a.onSavePressed=a.onSavePressed.bind(Object(f.a)(Object(f.a)(a))),a.resetModalData=a.resetModalData.bind(Object(f.a)(Object(f.a)(a))),a.fetchData=a.fetchData.bind(Object(f.a)(Object(f.a)(a))),a.onTextInputFocus=a.onTextInputFocus.bind(Object(f.a)(Object(f.a)(a))),a.onSocketMessageReceived=a.onSocketMessageReceived.bind(Object(f.a)(Object(f.a)(a))),a.connection=void 0,a.producer=void 0,a.jwtToken=void 0,a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentWillUnmount",value:function(){this.connection.close(),this.producer.close()}},{key:"login",value:function(){var e=this,t="https://".concat(this.state.selectedRegionUrl,"/_tenant/_mm/_fabric/_system/_open/auth");p.a.ajax({url:t,method:"POST",data:JSON.stringify({tenant:"demo",username:"demouser",password:"demouser"}),dataType:"json",success:function(t){e.jwtToken=t.jwt,e.ajaxSetup(),e.initWebSocket(),e.fetchData()},error:function(){return e.handleSnackbar("Auth failed.")}})}},{key:"ajaxSetup",value:function(){p.a.ajaxSetup({headers:{Authorization:"bearer ".concat(this.jwtToken)}})}},{key:"initWebSocket",value:function(){var e=this,t=this.state,a=t.wsUrl,n=t.producerUrl;this.connection=new WebSocket(a),this.connection.onmessage=this.onSocketMessageReceived,this.connection.onopen=function(){return console.log("WS connection established")},this.connection.onerror=function(){return console.log("Failed to establish WS connection")},this.connection.onclose=function(){return console.log("Closing WS connection")},this.producer=new WebSocket(n),this.producer.onopen=function(){setInterval(function(){e.producer.send(JSON.stringify({payload:"noop"}))},3e4)}}},{key:"deleteData",value:function(e){this.setState({data:re(e,this.state.data)})}},{key:"addOrUpdateData",value:function(e){this.setState({data:ie(e,this.state.data)})}},{key:"onSocketMessageReceived",value:function(e){var t=JSON.parse(e.data),a={messageId:t.messageId};if(this.connection.send(JSON.stringify(a)),"noop"!==t.payload){var n=JSON.parse(atob(t.payload));n._delete?this.deleteData(n._key):this.addOrUpdateData(n)}}},{key:"fetchData",value:function(e){var t=this,a=this.state.baseUrl;this.setState({isLoading:!0},function(){p.a.ajax({type:"POST",contentType:"text/plain",processData:!1,cache:!1,url:a,data:'{"action":"read"}',success:function(e){t.resetModalData(),t.setState({isLoading:!1,data:oe(e)})},error:function(a){e&&t.resetModalData(),t.setState({isLoading:!1}),t.handleSnackbar("Could not fetch data"),console.log("Error:",a)}})})}},{key:"onFabPress",value:function(){this.setState({shouldShowModal:!0})}},{key:"resetModalData",value:function(){this.setState({lastEditElem:void 0,shouldShowModal:!1,isEdit:!1,firstName:"",lastName:"",emailAddress:"",firstNameHasError:!1,lastNameHasError:!1,emailAddressHasError:!1})}},{key:"validate",value:function(){var e=this.state,t=e.firstName,a=e.lastName,n=e.emailAddress,s={};return this.state.isEdit?this.state.lastEditElem.email.trim()||(s.emailAddressHasError=!0):(t.trim()||(s.firstNameHasError=!0),a.trim()||(s.lastNameHasError=!0),n.trim()||(s.emailAddressHasError=!0)),s}},{key:"onSavePressed",value:function(){var e=this,t=this.state.baseUrl,a=this.validate();if(0===Object.keys(a).length){var n="Contact details added successfully",s="Contact details could not be added",o={action:"create",data:{firstname:this.state.firstName,lastname:this.state.lastName,email:this.state.emailAddress}};this.state.isEdit&&(o={action:"update",data:{key:this.state.lastEditElem.key,firstname:this.state.lastEditElem.firstname,lastname:this.state.lastEditElem.lastname,email:this.state.lastEditElem.email}},n="Contact details updated successfully",s="Contact details could not be updated"),p.a.ajax({type:"POST",contentType:"text/plain",processData:!1,cache:!1,url:t,data:JSON.stringify(o),success:function(){e.handleSnackbar(n),e.resetModalData()},error:function(t){e.handleSnackbar(s),e.resetModalData(),console.log("Error:",t)}})}else this.setState(Object(i.a)({},a))}},{key:"onTextInputFocus",value:function(e){this.state["".concat(e,"HasError")]&&this.setState(Object(l.a)({},"".concat(e,"HasError"),!1))}},{key:"onEditPressed",value:function(e){e&&this.setState({shouldShowModal:!0,isEdit:!0,lastEditElem:e})}},{key:"onRemovePressed",value:function(e){var t=this,a=this.state.baseUrl;e&&this.setState({lastEditElem:e},function(){p.a.ajax({type:"POST",contentType:"text/plain",processData:!1,cache:!1,url:a,data:JSON.stringify({action:"delete",data:{key:e.key}}),success:function(){t.handleSnackbar("Contact details removed successfully"),t.resetModalData()},error:function(e){t.handleSnackbar("Contact details could not be removed"),t.resetModalData(),console.log("Error:",e)}})})}},{key:"handleSnackbar",value:function(e){var t=this;this.setState({showSnackbar:!0,snackbarText:e},function(){setTimeout(function(){t.setState({showSnackbar:!1,snackbarText:""})},2e3)})}},{key:"renderDialogContent",value:function(){var e=this,t=this.state.lastEditElem||{},a=t.firstname,n=t.lastname,o=t.email;return s.a.createElement(K.a,null,s.a.createElement(Y.a,null,this.state.isEdit?"Fill in the fields to be updated.":"Provide all the details to add a new contact."),s.a.createElement(N.a,{onFocus:function(){return e.onTextInputFocus("firstName")},required:!this.state.isEdit,error:this.state.firstNameHasError,style:{display:"block"},label:"First Name",value:this.state.isEdit?a:this.state.firstName,onChange:function(t){if(e.state.isEdit){var a=Object(i.a)({},e.state.lastEditElem);a.firstname=t.target.value,e.setState({lastEditElem:a})}else e.handleFormChange("firstName")(t)},margin:"normal"}),s.a.createElement(N.a,{onFocus:function(){return e.onTextInputFocus("lastName")},required:!this.state.isEdit,error:this.state.lastNameHasError,style:{display:"block"},label:"Last Name",value:this.state.isEdit?n:this.state.lastName,onChange:function(t){if(e.state.isEdit){var a=Object(i.a)({},e.state.lastEditElem);a.lastname=t.target.value,e.setState({lastEditElem:a})}else e.handleFormChange("lastName")(t)},margin:"normal"}),s.a.createElement(N.a,{onFocus:function(){return e.onTextInputFocus("emailAddress")},required:!0,error:this.state.emailAddressHasError,style:{display:"block"},label:"Email",value:this.state.isEdit?o:this.state.emailAddress,onChange:function(t){if(e.state.isEdit){var a=Object(i.a)({},e.state.lastEditElem);a.email=t.target.value,e.setState({lastEditElem:a})}else e.handleFormChange("emailAddress")(t)},margin:"normal"}))}},{key:"handleModalClose",value:function(){var e,t=this,a=this.state.selectedRegionUrl;this.setState({regionModal:!1,baseUrl:(e=a,"https://".concat(e,"/_tenant/demo/_fabric/addressbook/_fn/addressbook")),wsUrl:le(a),producerUrl:ce(a)},function(){t.login()})}},{key:"renderRegionModal",value:function(){var e=this,t=this.state,a=t.regionModal,n=t.availableRegions,o=t.selectedRegionUrl;return s.a.createElement(J.a,{fullWidth:!0,open:a},s.a.createElement(G.a,{id:"form-dialog-title"},"Select Region:"),s.a.createElement(K.a,null,s.a.createElement(ee.a,{onChange:function(t){var a=t.target.value,s=n.find(function(e){return e.value===a}).label;e.setState({selectedRegionUrl:a,selectedRegionName:s})},value:o},n.map(function(e){return s.a.createElement(ae.a,{key:e.label,value:e.value,control:s.a.createElement(X.a,null),label:e.label})}))),s.a.createElement(q.a,null,s.a.createElement(S.a,{disabled:!o,onClick:function(){return e.handleModalClose()},size:"small",variant:"text",color:"primary"},s.a.createElement("span",{className:"actions"},"CONFIRM"))))}},{key:"render",value:function(){var e=this,t=this.state,a=t.data,n=t.selectedRegionName;return s.a.createElement("div",{className:"App"},s.a.createElement("header",{className:"App-header"},s.a.createElement("img",{src:v.a,alt:"logo",style:{height:"100px"}}),s.a.createElement("h1",{className:"App-title"},"Address book is connected to ",n)),this.renderRegionModal(),s.a.createElement(P.a,null,s.a.createElement(w.a,null,s.a.createElement(F.a,null,s.a.createElement(R.a,null,s.a.createElement(D.a,null,"KEY"),s.a.createElement(D.a,null,"First Name"),s.a.createElement(D.a,null,"Last Name"),s.a.createElement(D.a,null,"Email"),s.a.createElement(D.a,{style:{paddingLeft:"40px"}},"Actions"))),s.a.createElement(C.a,null,a.map(function(t){return s.a.createElement(R.a,{key:Math.random()},s.a.createElement(D.a,{component:"th",scope:"row"},t.key),s.a.createElement(D.a,null,t.firstname),s.a.createElement(D.a,null,t.lastname),s.a.createElement(D.a,null,t.email),s.a.createElement(D.a,null,s.a.createElement("div",null,s.a.createElement(S.a,{onClick:function(){e.onEditPressed(t)},size:"small",variant:"text",color:"primary"},s.a.createElement("span",{style:{fontSize:"10px"}},"Edit")),s.a.createElement(S.a,{onClick:function(){e.onRemovePressed(t)},size:"small",variant:"text",color:"secondary"},s.a.createElement("span",{style:{fontSize:"10px"}},"Remove")))))})))),s.a.createElement(_.a,{onClick:this.onFabPress,style:{position:"fixed",bottom:"70px",right:"70px"},size:"large",color:"primary"},s.a.createElement("span",{style:{fontSize:"30px"}},"+")),s.a.createElement(J.a,{onClose:this.resetModalData,open:this.state.shouldShowModal},s.a.createElement(G.a,{id:"form-dialog-title"},this.state.isEdit?"Edit contact details":"Add contact details"),this.renderDialogContent(),s.a.createElement(q.a,null,s.a.createElement(S.a,{onClick:function(){e.onSavePressed()},size:"small",variant:"text",color:"primary"},s.a.createElement("span",{className:"actions"},this.state.isEdit?"UPDATE":"SAVE")),s.a.createElement(S.a,{onClick:this.resetModalData,size:"small",variant:"text",color:"secondary"},s.a.createElement("span",{className:"actions"},"DISCARD")))),s.a.createElement(W.a,{open:this.state.showSnackbar,onClose:this.handleClose,ContentProps:{"aria-describedby":"message-id"},message:s.a.createElement("span",{id:"message-id"},this.state.snackbarText)}),this.state.isLoading&&s.a.createElement("img",{src:k.a,alt:"logo",className:"spinner"}))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(ue,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[117,2,1]]]);
//# sourceMappingURL=main.b0aa07bd.chunk.js.map